@using StationeryManager.Util
@inherits LayoutComponentBase
@inject AppStateService AppState
@implements IDisposable

<div class="page">
	<div class="sidebar">
		<NavMenu />
	</div>

	<main>
		<div class="top-row px-4">
			<MudText Typo="Typo.h6" Class="ml-2">@_title</MudText>
		</div>
		@* Required *@
		<MudThemeProvider />
		<MudPopoverProvider />

		@* Needed for dialogs *@
		<MudDialogProvider />

		@* Needed for snackbars *@
		<MudSnackbarProvider />

		<article class="content px-4">
			@Body
		</article>
	</main>
</div>

<div id="blazor-error-ui">
	An unhandled error has occurred.
	<a href="" class="reload">Reload</a>
	<a class="dismiss">🗙</a>
</div>

@code {
	private string _title = "";

	protected override void OnInitialized()
	{
		_title = AppState.Title;
		AppState.OnTitleChanged += UpdateTitle;
	}

	private void UpdateTitle()
	{
		_title = AppState.Title;
		InvokeAsync(StateHasChanged);
	}

	public void Dispose()
	{
		AppState.OnTitleChanged -= UpdateTitle;
	}
}
