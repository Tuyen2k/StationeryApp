@using StationeryManagerLib.Entities

@{
	ViewData["Title"] = "Danh sách tài khoản";
	@model List<AccountModel>
}


<h1>@ViewData["Title"]</h1>
<div class="text-right mb-3">
	<a asp-action="Create" class="btn btn-primary">Thêm tài khoản</a>
</div>
<form asp-action="Index" method="get" class="mb-3">
	<div class="input-group">
		<input type="text" name="search" value="@Context.Request.Query["search"]" class="form-control" placeholder="Tìm theo tên người dùng..." />
		<button type="submit" class="btn btn-primary">Tìm</button>
	</div>
</form>

@if (Model.Count == 0)
{
	<div class="alert alert-info">Không có tài khoản nào.</div>
}
else
{

	<div class="container">
		<table class="table table-bordered">
			<thead>
				<tr>
					<th>Tên tài khoản</th>
					<th>Email</th>
					<th>Số điện thoại</th>
					<th>Lịch sử thao tác</th>
					<th>Ctrl</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var account in Model)
				{
					<tr>
						<td>@account.Name</td>
						<td>@account.Email</td>
						<td>@account.Phone</td>
						<td>
							@if (!string.IsNullOrEmpty(account.CreatedByAccountEmail))
							{
								<div><strong>Người tạo:</strong> @account.CreatedByAccountEmail - @account.CreatedAt.ToString("HH:mm dd/MM/yyyy")</div>
							}
							@if (!string.IsNullOrEmpty(account.UpdatedByAccountEmail))
							{
								<div><strong>Người sửa cuối:</strong> @account.UpdatedByAccountEmail - @account.UpdatedAt.ToString("HH:mm dd/MM/yyyy")</div>
							}
						</td>
						<td>
							<a asp-action="Edit" asp-route-id="@account.Id">Sửa</a> |
							<a asp-action="Detail" asp-route-id="@account.Id">Chi tiết</a> |
							<a class="text-danger"
									data-bs-toggle="modal"
									data-bs-target="#deleteModal"
									data-id="@account.Id"
									data-name="@account.Name">
								Xoá
							</a>
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
}

@* Thêm modal xác nhận xóa account, xư lý property data-name trong thẻ a mở modal và hiển thị trong phần thông tin xóa *@
<!-- Modal xác nhận xoá -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form asp-action="Delete" method="post">
				<div class="modal-header">
					<h5 class="modal-title" id="deleteModalLabel">Xác nhận xoá</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<input type="hidden" name="id" id="deleteId" />
					<p>Bạn có chắc muốn xoá tài khoản <strong id="deleteName"></strong> không?</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Huỷ</button>
					<button type="submit" class="btn btn-danger">Xoá</button>
				</div>
			</form>
		</div>
	</div>
</div>

@section Scripts {
	<script>
		var deleteModal = document.getElementById('deleteModal');
		deleteModal.addEventListener('show.bs.modal', function (event) {
			var button = event.relatedTarget;
			var id = button.getAttribute('data-id');
			var name = button.getAttribute('data-name');

			var modalIdInput = deleteModal.querySelector('#deleteId');
			var modalName = deleteModal.querySelector('#deleteName');

			modalIdInput.value = id;
			modalName.textContent = name;
		});
	</script>
}
